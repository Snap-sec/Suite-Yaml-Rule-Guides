rule_name: Remote File Inclusion (Windows)
description: Detects RFI on Windows systems, often utilizing UNC paths or standard URL inclusion.

transform:
  query:
    transformations:
      - replace_all_values_one_by_one:
          - "\\\\127.0.0.1\\c$\\windows\\win.ini"
          - "http://example.com"
          - "http://example.com/index.html"
          - "http://example.com?"
          - "http://example.com%00"
  body:
    transformations:
      - replace_all_values_one_by_one:
          - "\\\\127.0.0.1\\c$\\windows\\win.ini"
          - "http://example.com"
          - "http://example.com/index.html"
          - "http://example.com?"
          - "http://example.com%00"
  header:
    transformations:
      - replace_all_values_one_by_one:
          - "\\\\127.0.0.1\\c$\\windows\\win.ini"
          - "http://example.com"
          - "http://example.com/index.html"
          - "http://example.com?"
          - "http://example.com%00"

match_on:
  body:
    regex: 
      - "<h1>Example Domain</h1>"
      - "\\[fonts\\]"
      - "\\[extensions\\]"

report:
  title: "Remote File Inclusion (Windows)"
  description: |
    The application is vulnerable to Remote File Inclusion (RFI).
    It successfully included content from a remote server or local SMB share.

    Original Request:
    {{original}}

    Transformed Request:
    {{req}}

    Response:
    {{res}}

  cwe: "CWE-98"
  severity: critical
  cvssScore: "9.8"
  mitigation: |
    1. Disable `allow_url_include` in php.ini.
    2. Input validation and sanitization.
    3. Use an allowlist for file inclusions.
  stepsToReproduce: |
    1. Inject RFI payload (URL or UNC path).
    2. Observe included content.
  tags: "rfi,windows,remote,vuln"
  impact: "Remote Code Execution (RCE)"
