rule_name: CORS Trusted Arbitrary Subdomain
single_match: true
description: Detects if the application trusts any subdomain of the target Host.
transform:
  header:
    replace:
      Origin: "https://evil.snapsec.co"
match_on:
  status: 200
  header:
    Access-Control-Allow-Origin: 
      regex: "https://evil\\..*"
    Access-Control-Allow-Credentials: "true"
report:
  title: "CORS: Arbitrary Subdomain Trusted"
  description: |
    The application trusts arbitrary subdomains (e.g. 'evil.target.com').
    If an attacker can claim a subdomain or find XSS in any subdomain, they can compromise the main application.

    Original Request:
    {{original}}

    Transformed Request:
    {{req}}

    Response:
    {{res}}

  cwe: "CWE-942"
  severity: medium
  cvssScore: "6.0"
  mitigation: |
    1. Explicitly whitelist only required subdomains.
    2. Avoid wildcard subdomain trust (*.example.com) if possible.
  stepsToReproduce: |
    1. Send request with 'Origin: https://evil.snapsec.co'
    2. Observe reflection of the origin with credentials.
  tags: "cors,misconfiguration,medium"
  impact: "Expanded attack surface via subdomains"
