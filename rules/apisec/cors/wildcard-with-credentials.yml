rule_name: CORS Wildcard with Credentials
single_match: true
description: Detects if the application sets Access-Control-Allow-Origin to * and Access-Control-Allow-Credentials to true.
transform:
  header:
    add:
      Origin: "https://example.com"
match_on:
  status: 200
  header:
    Access-Control-Allow-Origin: "*"
    Access-Control-Allow-Credentials: "true"
report:
  title: "CORS: Wildcard Origin with Credentials"
  description: |
    The application allows all origins ('*') while also enabling credentials ('Access-Control-Allow-Credentials: true').

    Note: This is technically disallowed by the CORS specification and most browsers will block it, but it indicates a severe misconfiguration. Some older browsers or non-browser clients might respect it. It often suggests the developers intend to allow public authenticated access, which is a logic flaw.

    Original Request:
    {{original}}

    Transformed Request:
    {{req}}

    Response:
    {{res}}

  cwe: "CWE-942"
  severity: high
  cvssScore: "6.5"
  mitigation: |
    1. Never use '*' with 'Access-Control-Allow-Credentials: true'.
    2. Specify exact trusted origins.
  stepsToReproduce: |
    1. Send request to {{req.url}} with any origin
    2. Observe response headers 'Access-Control-Allow-Origin: *' and 'Access-Control-Allow-Credentials: true'
  tags: "cors,misconfiguration,high"
  impact: "Potential authentication bypass or data leak"
